# APP接口示例

## 1、新建训练、加入已有训练、专家修改结果加入训练的接口一致

加入训练消息示例如下,topic：command/S1-2S0007-template/train：

```json
{
    'phase': 'executing',      #执行训练命令
    'monitoringUnit': 'S1-2S0007-template', 
    'sampleUnit': 'train',
    'parameters': {
        'equipTemplate': 'S1-2S0007-template', #模板类型
    	#data是json字符串
    	'data':'[{
                "s-data-1":"HS201声音url"
                "s-data-2":"HS201XYZ震动"
                "s-data-3":"HS202声音"
                "s-data-4":"HS202XYZ震动"
                "s-data-7":"HS211电流"
    			'time': '2020-08-06-16-10-00',   #训练时间，建立处理成该格式
				"tagType":{
                    "fan-aging":80,
                    "short":0
                }
				},{
                "s-data-1":"HS201声音url"
                "s-data-2":"HS201XYZ震动"
                "s-data-3":"HS202声音"
                "s-data-4":"HS202XYZ震动"
                "s-data-7":"HS211电流"
    			'time': '2020-08-06-16-10-00',   #训练时间，建立处理成该格式
				"tagTag":{
                    "fan-aging":80,
                    "short":0
                }
			}]', 
	'index':1
	}
    'timeout': 30000,
    'operator': 'admin',                 #操作人，必须登录情况下训练
    'startTime': '2020-08-13T06:32:50.861Z',
    'retryTimes': 0,
    'endTime': None, 
    'result': None, 
    '_phase': 'executing'
}
```

训练完成返回的消息如下，topic：command/S1-2S0007-template/train：

```json
{
    'phase': 'complete',             #训练完成标识
    'monitoringUnit': 'S1-2S0007-template',
    'sampleUnit': 'train',
    'parameters': {
        'equipTemplate': 'S1-2S0007-template', #模板类型
    	#data是json字符串
    	'data':'[{
                "s-data-1":"HS201声音url"
                "s-data-2":"HS201XYZ震动"
                "s-data-3":"HS202声音"
                "s-data-4":"HS202XYZ震动"
                "s-data-7":"HS211电流"
    			'time': '2020-08-06-16-10-00',   #训练时间，建立处理成该格式
				"tagTag":{
                    "fan-aging":80,
                    "short":0
                }
				},{
                "s-data-1":"HS201声音url"
                "s-data-2":"HS201XYZ震动"
                "s-data-3":"HS202声音"
                "s-data-4":"HS202XYZ震动"
                "s-data-7":"HS211电流"
    			'time': '2020-08-06-16-10-00',   #训练时间，建立处理成该格式
				"tagTag":{
                    "fan-aging":80,
                    "short":0
                }
			}]', 
	'index':1
	}
    'timeout': 30000,
    'operator': 'admin',
    'startTime': '2020-08-13T06:32:50.861Z',
    'retryTimes': 0, 
    'endTime': '2020-08-13 14:56:38.950779', #训练完成时间
    'result': {
        "fan-aging":{
            'accuracy': 100.0, #训练的准确率（交叉验证)
            'features': [[-1.0258801994506608, 0.8504886153835203, 0.7361395965212328, 0.7267563215881498, -0.48224603045114045, -0.4662510541129176, 0.8507912454001121, -1.827884438051297, -1.8193377409944762, -0.18993279176150737, 0.7082367424878798, 0.5874026578546057, 0.5874022899069861, 0.4461353418731847, -0.450230470991489, -1.1798586423346202, -0.39981109792506175, -0.4179479174861647, 1.0955345025603085, 0.3932502530552369, 0.4156807452194158, 0.41568567954889274, -0.4401103899149427, -0.44743936521781735, -0.5587561723101423, -0.44107639856712477, -0.457325872022834, -1.5180405569450068, 0.19180910786036687, 0.2304301523516183, 0.2304098549982263, -0.5212232193098623, -0.5063187265007785, -0.5676779746239292, -0.5632449885831916, -0.5331227843110874, -1.0258801994494418, 0.6940873184936028, 0.5865462125280371, 0.6856905870213366, -0.447809518481861, -0.44731737246714004, 0.6890424197923345, -0.6750478951520729, 1.0261073466035873], [-0.6376810556044326, 0.812990627669051, 0.7113243754486914, 0.9202829433275976, -0.4561540194147499, -0.45579596938905587, 0.8129049835825117, 1.426140881938185, 1.4554006122603145, 0.9106843343007471, 0.6144435961307838, 0.5392434768483096, 0.5392426359935663, 0.44233801563599645, -0.45016197684372594, -1.1764836312087568, -0.44405648205715104, -0.4557294197340806, -1.3168299743717762, 0.46865018886016935, 0.46035880787956995, 0.46035383782531936, -0.4515382707642279, -0.4484606194281703, -0.572943933132013, -0.5132417975056592, -0.48618988595143264, -0.3798379625641903, 0.42822565592761846, 0.43236647370861603, 0.4323595784271975, -0.5778006430612662, -0.5469647590249939, -0.5896969929671902, -0.6556370316589116, -0.5562544145037129, -0.6376810556032994, 0.6114749047315692, 0.5418691733221991, 0.6077695827870871, -0.44772110077392396, -0.44729656192536416, 0.6082033690004384, -0.6011038852136154, 0.6377215743455936], [-0.30025776935419907, 0.44759018423196, 0.4617204131878033, 0.54013704212829, -0.4568055444542577, -0.45123143954418693, 0.4474339026603358, 0.21059031779924528, 0.22290239387588312, -0.5285487939599283, 0.45479468446856436, 0.4553888135725447, 0.4553888109183252, 0.532635434127132, -0.44798064963867895, -0.4473083413719912, -0.4713166755535845, -0.4702867187029747, 0.870124220947071, 0.4318355762345517, 0.4386208487115675, 0.43862340623539947, -0.4449048134971042, -0.4469575308463192, -0.47271183558316404, -0.4255582311672354, -0.44199618449690803, 0.6501233293765947, 0.5461919345480349, 0.5313246491931641, 0.5313346485659624, -0.39705673771388006, -0.4094384763358421, -0.45648349213885436, -0.36426941962037807, -0.4442925657979295, -0.30025776935379633, 0.4547224264951039, 0.45527537266142387, 0.45626322835576516, -0.44742259125033323, -0.44723137952033987, 0.45489471117638963, -0.4567590949007515, 0.30017546265911343], [-0.1444614969862972, -0.012400604265875553, 0.12423938362166874, -0.11540953361609971, -0.42333813022319594, -0.43201515951059954, -0.01239528410833569, -0.3552997242433966, -0.3577256003320037, -1.8245439099900114, 0.17279179782854912, 0.30086560285693803, 0.30086763175265424, 0.42326621599112035, -0.44449893786072026, 0.5125446838534387, -0.4557179739923074, -0.4440345385992826, -0.21881025145029281, 0.3661244330955176, 0.3994558985650967, 0.39945147048939683, -0.4523556263966805, -0.44649452967936615, -0.3264081251446943, -0.4216993121501768, -0.4243627442619219, 1.451681168150875, 0.5345415267961712, 0.5216030892471512, 0.521629463400248, -0.39266741608424427, -0.40624391596747395, -0.3394081764454507, -0.35821824863932755, -0.37460359674907445, -0.14446149698575883, 0.1805819252321376, 0.2975239595458395, 0.18665719823852966, -0.4465598192505744, -0.4471003099705888, 0.18619692389499448, -0.19801540746283874, 0.1443348401038689], [0.00354865186942207, 0.0025731871092705663, 0.1356962141610247, 0.006644403511156754, -0.41698700380668036, -0.43059557983531765, 0.0024512450091755222, -0.11733021745567743, -0.1178971279986608, 0.5047332377477869, 0.24601241149866035, 0.3418303377419477, 0.34182965268437726, 0.3896024864262075, -0.4431881239937947, 0.8843539506733297, -0.4645672726978821, -0.4477951128465534, 0.8262186157724136, 0.5714305085812669, 0.5202995877713225, 0.5203014548663794, -0.4471400687885562, -0.4467154782597812, -0.2926628944055385, -0.43342852533953574, -0.42570251867560915, -0.8092269178384768, 0.5188246923103916, 0.5084705854672347, 0.5084589367192082, -0.3399441934566302, -0.36268323936983976, -0.26811541333983796, -0.27579510105664107, -0.3202031039980776, 0.0035486518709722218, 0.2586878187269182, 0.34334372267144897, 0.2652282444764204, -0.44655466488458867, -0.44712234632502734, 0.2627271295583691, -0.2736710990220251, -0.003710209667431036], [2.1047318695261676, -2.1012420101279257, -2.1691199829404186, -2.0784111769390945, 2.2355307283500245, 2.2358892023920776, -2.101186092543248, 0.6637831800129103, 0.6166574631889198, 1.127607923662913, -2.196279232414439, -2.2247308888743462, -2.224731021255909, -2.2339774940536405, 2.2360601593284093, 1.4067519803886028, 2.2354695022259863, 2.235793707369056, -1.2562371134577237, -2.23129095982674, -2.234415888146972, -2.2344158489653885, 2.236049169361512, 2.236067523431454, 2.2234829605755544, 2.2350042647297323, 2.2355772054087053, 0.6053009398202017, -2.2195929174425864, -2.224194949967782, -2.22419248211084, 2.228692209625884, 2.2316491171989283, 2.221382049515262, 2.217164789558452, 2.2284764653598814, 2.1047318695271975, -2.1995543936793305, -2.2245584407289485, -2.2016088408791465, 2.236067694641281, 2.23606797020846, -2.201064553422514, 2.2045973817513036, -2.104629014043597]]
        },
 "short":{
            'accuracy': 100.0, #训练的准确率（交叉验证)
            'features': [[-1.0258801994506608, 0.8504886153835203, 0.7361395965212328, 0.7267563215881498, -0.48224603045114045, -0.4662510541129176, 0.8507912454001121, -1.827884438051297, -1.8193377409944762, -0.18993279176150737, 0.7082367424878798, 0.5874026578546057, 0.5874022899069861, 0.4461353418731847, -0.450230470991489, -1.1798586423346202, -0.39981109792506175, -0.4179479174861647, 1.0955345025603085, 0.3932502530552369, 0.4156807452194158, 0.41568567954889274, -0.4401103899149427, -0.44743936521781735, -0.5587561723101423, -0.44107639856712477, -0.457325872022834, -1.5180405569450068, 0.19180910786036687, 0.2304301523516183, 0.2304098549982263, -0.5212232193098623, -0.5063187265007785, -0.5676779746239292, -0.5632449885831916, -0.5331227843110874, -1.0258801994494418, 0.6940873184936028, 0.5865462125280371, 0.6856905870213366, -0.447809518481861, -0.44731737246714004, 0.6890424197923345, -0.6750478951520729, 1.0261073466035873], [-0.6376810556044326, 0.812990627669051, 0.7113243754486914, 0.9202829433275976, -0.4561540194147499, -0.45579596938905587, 0.8129049835825117, 1.426140881938185, 1.4554006122603145, 0.9106843343007471, 0.6144435961307838, 0.5392434768483096, 0.5392426359935663, 0.44233801563599645, -0.45016197684372594, -1.1764836312087568, -0.44405648205715104, -0.4557294197340806, -1.3168299743717762, 0.46865018886016935, 0.46035880787956995, 0.46035383782531936, -0.4515382707642279, -0.4484606194281703, -0.572943933132013, -0.5132417975056592, -0.48618988595143264, -0.3798379625641903, 0.42822565592761846, 0.43236647370861603, 0.4323595784271975, -0.5778006430612662, -0.5469647590249939, -0.5896969929671902, -0.6556370316589116, -0.5562544145037129, -0.6376810556032994, 0.6114749047315692, 0.5418691733221991, 0.6077695827870871, -0.44772110077392396, -0.44729656192536416, 0.6082033690004384, -0.6011038852136154, 0.6377215743455936], [-0.30025776935419907, 0.44759018423196, 0.4617204131878033, 0.54013704212829, -0.4568055444542577, -0.45123143954418693, 0.4474339026603358, 0.21059031779924528, 0.22290239387588312, -0.5285487939599283, 0.45479468446856436, 0.4553888135725447, 0.4553888109183252, 0.532635434127132, -0.44798064963867895, -0.4473083413719912, -0.4713166755535845, -0.4702867187029747, 0.870124220947071, 0.4318355762345517, 0.4386208487115675, 0.43862340623539947, -0.4449048134971042, -0.4469575308463192, -0.47271183558316404, -0.4255582311672354, -0.44199618449690803, 0.6501233293765947, 0.5461919345480349, 0.5313246491931641, 0.5313346485659624, -0.39705673771388006, -0.4094384763358421, -0.45648349213885436, -0.36426941962037807, -0.4442925657979295, -0.30025776935379633, 0.4547224264951039, 0.45527537266142387, 0.45626322835576516, -0.44742259125033323, -0.44723137952033987, 0.45489471117638963, -0.4567590949007515, 0.30017546265911343], [-0.1444614969862972, -0.012400604265875553, 0.12423938362166874, -0.11540953361609971, -0.42333813022319594, -0.43201515951059954, -0.01239528410833569, -0.3552997242433966, -0.3577256003320037, -1.8245439099900114, 0.17279179782854912, 0.30086560285693803, 0.30086763175265424, 0.42326621599112035, -0.44449893786072026, 0.5125446838534387, -0.4557179739923074, -0.4440345385992826, -0.21881025145029281, 0.3661244330955176, 0.3994558985650967, 0.39945147048939683, -0.4523556263966805, -0.44649452967936615, -0.3264081251446943, -0.4216993121501768, -0.4243627442619219, 1.451681168150875, 0.5345415267961712, 0.5216030892471512, 0.521629463400248, -0.39266741608424427, -0.40624391596747395, -0.3394081764454507, -0.35821824863932755, -0.37460359674907445, -0.14446149698575883, 0.1805819252321376, 0.2975239595458395, 0.18665719823852966, -0.4465598192505744, -0.4471003099705888, 0.18619692389499448, -0.19801540746283874, 0.1443348401038689], [0.00354865186942207, 0.0025731871092705663, 0.1356962141610247, 0.006644403511156754, -0.41698700380668036, -0.43059557983531765, 0.0024512450091755222, -0.11733021745567743, -0.1178971279986608, 0.5047332377477869, 0.24601241149866035, 0.3418303377419477, 0.34182965268437726, 0.3896024864262075, -0.4431881239937947, 0.8843539506733297, -0.4645672726978821, -0.4477951128465534, 0.8262186157724136, 0.5714305085812669, 0.5202995877713225, 0.5203014548663794, -0.4471400687885562, -0.4467154782597812, -0.2926628944055385, -0.43342852533953574, -0.42570251867560915, -0.8092269178384768, 0.5188246923103916, 0.5084705854672347, 0.5084589367192082, -0.3399441934566302, -0.36268323936983976, -0.26811541333983796, -0.27579510105664107, -0.3202031039980776, 0.0035486518709722218, 0.2586878187269182, 0.34334372267144897, 0.2652282444764204, -0.44655466488458867, -0.44712234632502734, 0.2627271295583691, -0.2736710990220251, -0.003710209667431036], [2.1047318695261676, -2.1012420101279257, -2.1691199829404186, -2.0784111769390945, 2.2355307283500245, 2.2358892023920776, -2.101186092543248, 0.6637831800129103, 0.6166574631889198, 1.127607923662913, -2.196279232414439, -2.2247308888743462, -2.224731021255909, -2.2339774940536405, 2.2360601593284093, 1.4067519803886028, 2.2354695022259863, 2.235793707369056, -1.2562371134577237, -2.23129095982674, -2.234415888146972, -2.2344158489653885, 2.236049169361512, 2.236067523431454, 2.2234829605755544, 2.2350042647297323, 2.2355772054087053, 0.6053009398202017, -2.2195929174425864, -2.224194949967782, -2.22419248211084, 2.228692209625884, 2.2316491171989283, 2.221382049515262, 2.217164789558452, 2.2284764653598814, 2.1047318695271975, -2.1995543936793305, -2.2245584407289485, -2.2016088408791465, 2.236067694641281, 2.23606797020846, -2.201064553422514, 2.2045973817513036, -2.104629014043597]]
        }
        
        #本序号训练的特征值
        'index': ['1'] #已完成的训练的序号，
		'state':1  #训练完成标识位
    },
    '_phase': 'executing',
	'process':100  #process在程序执行的过程中不断地返回，执行完毕返回100
}
```

代码已通过下述格式测试通过

```json
{
    "phase": "executing",
    "sampleUnit": "train",
    "parameters": {
        "equipTemplate": "S1-2S0007-template",
    	"data":'[{
                "s-data-1":"http://lab.huayuan-iot.com/resource/upload/predict/9H200A2600039/input/HLotHYzgC.csv",
    			"time": "2020-08-06-16-10-07",
				"tagType":{
                    "fan-aging":80
                }
				},{
                "s-data-1":"http://lab.huayuan-iot.com/resource/upload/predict/9H200A2600039/input/3meYgzpkN.csv",
    			"time": "2020-08-06-16-10-07",
                "tagType":{
                    "fan-aging":50
                }
                }]',
	"index":1
	},
    "timeout": 30000,
    "operator": "admin",
    "startTime": "2020-08-13T06:32:50.861Z",
    "retryTimes": 0,
    "endTime": "",
    "result": "",
    "_phase": "executing"
}
```

## 2、预测诊断接口

示例 topic：command/hyiot_yangxin_kuming_motor-1/predict：

格式为 command/设备名称/predict

```json
 {
     'equipment': 'motor-1',
     'user':'hyiot',
     'project':'yangxin',
     'station':"kuming",
     'equipTemplate':'262-MD1-M1-template', 
     'data':{
         "s-data-1":"HS201声音url",
         "s-data-2":"HS201XYZ震动",
         "s-data-3":"HS202声音",
         "s-data-4":"HS202XYZ震动",
         .
         .
         .
         "s-data-7":"HS211电流"
     }, 
     'startTime': '2020-08-6T16:19:39.858Z',
     'endTime': '020-08-6T16:20:39.858Z',
     'index':1,
     'result': {
		'state':0
     }
 }
```

诊断完成返回的数据 topic：command/motor/predict：

```json
 {
     'equipment': 'motor-1',
     'user':'hyiot',
     'project':'yangxin',
     'station':"kuming",
     'equipTemplate':'262-MD1-M1-template', 
     'data':{
         "s-data-1":"HS201声音url",
         "s-data-2":"HS201XYZ震动",
         "s-data-3":"HS202声音",
         "s-data-4":"HS202XYZ震动",
         .
         .
         .
         "s-data-7":"HS211电流"
     }, 
     'startTime': '2020-08-6T16:19:39.858Z',
     'endTime': '020-08-6T16:20:39.858Z',
     'index':1,
     'result': {
		'state':1,  #预测完成的标识位
         'predict-result':{
         "short":45,
         "fan-aging":86
     },
     'fft':{
        "s-data-1":"HS201声音url",
         "s-data-1_wav":"HS201声音wav的url",
         "s-data-2":"HS201XYZ震动",
         "s-data-3":"HS202声音",
         "s-data-4":"HS202XYZ震动",
         .
         .
         .
         "s-data-7":"HS211电流" 
     }
   }
 }
```

已通过下述数据通过测试：

```json
{
     'equipment': 'inverter-2',
     'user':'hyiot',
     'project':'yangxin',
     'station':"kuming",
     'equipTemplate':'S1-2S0007-template', 
     'data':{
         "s-data-1":"http://lab.huayuan-iot.com/resource/upload/predict/9H200A2600039/input/HLotHYzgC.csv"
     }, 
     'startTime': '2020-08-6T16:19:39.858Z',
     'endTime': '020-08-6T16:20:39.858Z',
     'index':1,
     'result': {
		'state':0
     }
 }
```

![img](%E6%9F%B3%E9%9B%A8%E7%9A%84%E5%8D%9A%E5%AE%A2.assets/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_15983193116815.png)

